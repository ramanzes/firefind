# firefind
simlpe MOD for find-text, with PHP and phpMorphy in mysqli

Идея создания подобного модуля родилась благодаря форкнутому проекту https://github.com/ramanzes/firewind в котором подробно описывается суть. Но сам код с замахом на индексацию, не потребовался т.к. его механика пока не продумана полностью. Цель создать удобный и понятный модуль для тестов инструмента phpMorhpy для лучшего поиска на сайтах PHP, удобный для обкатки и различных тестов на разных из доступных в словарях языках.

Простой самописный модуль поиска на сайте для движка на PHP с помощью функционала mysqli.
Есть большие перспективы в сторону усложнения и расширения возможностей поиска, с подключением методов библиотеки морфологического анализа, реализованная на платформе http://phpmorphy.sourceforge.net/dokuwiki/

На текущий момент подключается только один метод данной платформы, с помощью которого расширяется поисковой запрос в строке поиска до всех возможных вариаций каждого из искомых слов. mixed phpMorphy::getAllFormsWithGramInfo($word, $asText = true, $type = self::NORMAL)

Сейчас подключение этого модуля работает для пользователя через checkbox, однако текущая реализация с этим модулем поддерживает пока только русскоязычный текст. Английские слова
сейчас можно искать только без этого модуля.

Опции используемые при инициализации phpMorphy сейчас стандартные. 
Так как для PHPMORPHY_STORAGE_SHM требуется наличие расширения shmop.
Значение по умолчанию: PHPMORPHY_STORAGE_FILE
Допустимые значения:
    PHPMORPHY_STORAGE_FILE - использует файловые операции. Потребляется небольшое количество памяти. Самый медленный способ, однако, работает в любом окружении
    PHPMORPHY_STORAGE_MEM - загружает словари в память. Плюсы этого способа в том, что обеспечивается самый быстрый способ доступа и работа в любом окружении. Однако имеется один существенный минус – словарь загружается для каждого экземпляра класса phpMorphy. Что приводит к очень медленной инициализации phpMorphy и большому потреблению памяти (т.к. для каждого запроса в память загружается порядка 10Mb, соответственно при 10 одновременных запросах потребуется около 100Mb памяти. Потому данный способ может быть полезен только для CLI скриптов. Обратите внимание на директиву memory_limit в PHP, слишком низкое значение может вызвать ошибку «Fatal error: Allowed memory size of xxx bytes exhausted (tried to allocate xxx bytes)».
    PHPMORPHY_STORAGE_SHM - скорость сравнима с PHPMORPHY_STORAGE_MEM, однако словари загружаются в разделяемую память. Это предпочтительный способ, однако необходимо наличие shmop расширения, см. вывод php –m | grep shmop. phpMorphy загружает все словари в один сегмент разделяемой памяти (см опцию shm), поэтому необходимо установить размер сегмента таким образом, чтобы все словари с которыми предполагается работать умещались в данный сегмент (иначе возможны ошибки при иницализации: «Can`t find free space for XXX block»)
    

Что можно и нужно сделать: 
1) Продумать внедрение механизма индексированного поиска, начатый в проекте firewind.
2) Для увеличения скорости, также можно подключить опцию PHPMORPHY_STORAGE_SHM и подробную инструкцию всех нужных настроек и инструкцию для установки расширения shmop в PHP самого сервера. и возможные дополнительные настройки сервера во избежание ошибок.
3) Подключить словарь EN но разобраться с кодировкой пока не нашёл UTF8, которая взята за основу на текущем движке сайта. Сейчас есть /firewind/arhivmorphy/morphy-0.3.x-en_EN-windows-1250.zip все остальные словари которые были у разработчиков на данный момент тоже находятся там /firewind/arhivmorphy/ из них пока включён в функционал только русский язык.

Что есть:
1) удобный в подключении код на php. все настройки производятся через файл lib/config_class.php
указывают каталоги сервера, имена пользователя и паролья для mysql сервера. база и таблица для тестов в корне каталога firstbase.sql.
Файл для работы с базой данных lib/firefind_class.php файл обёртка его для методов в lib/global_class.php
Методы обнаружения и создания найденных фрагментов с подсчётом релевантности по перечесечениям этих фрагментов между собой от разных слов, в файле lib/fragments_class.php
2) Все файлы проекта phpMorphy находятся в отдельном каталоге firewind там же и словари. эти файлы от разработчиков не подвергались никаким изменениям с моей стороны. в этот же каталог добавлены два файла firewind.php и morphyus.php(немного дополнен методами) наследие проекта firewind - по своей сути обёртки для методов /phpmorphy/src/common.php
3) удобный шаблонизатор, шалбоны в каталоге tmpl для вывода найденных фрагментов в слайдеры по каждой из статье в которых есть совпадения. выводится в браузер через lib/searchcontent_class.php
4) Много комментариев своими словами в коде, на всякий случай...

